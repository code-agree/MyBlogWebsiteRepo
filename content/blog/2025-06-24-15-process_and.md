+++
title = '2025 06 24 15 Process_and'
date = 2025-06-24T15:43:41+08:00
draft = true
+++
### 进程

- 上下文切换
CPU上下文切换： 进程上下文切换、线程上下文切换、中断上下文切换
CPU的上下文: CPU寄存器 和 程序计数器

进程上下文切换不仅包括了虚拟内存、栈、全局变量等用户空间的资源，还包括内核堆栈、寄存器等内核空间的资源。

发生进程上下文切换的场景：
- CPU分配给该进程的时间片耗尽时，进程从运行状态变为就绪状态
- 进程在系统资源不足(内存不足)时，药等到资源满足才可以运行，这个时候进程也会被挂起，并由系统调度其他进程运行
- 进程sleep，主动挂起
- 有优先级更高的进程运行时，当前进程被挂起
- 硬件中断

### 线程

同一进程内多个线程之间之间可以共享代码段、数据段、打开的文件等资源，但每个线程各自都有一套独立的寄存器和栈，可以确保线程的控制流时相对独立的

优点：
- 一个进程中可以同时存在多个线程
- 各个线程之间可以并发执行
- 各个线程之间可以共享地址空间和文件等资源

缺点
- 当进程中的一个线程崩溃时，会导致其所属进程的所有线程崩溃。


进程 VS 线程
- 进程是资源(内存、打开的文件)分配的单位，线程是CPU调度的单位
- 进程拥有完整的资源平台，而线程只独享必不可少的资源，如寄存器和栈
- 线程能减少并发执行的时间和空间开销

线程能减少并发执行的时间和空间开销 为什么？
- 线程创建时间快
- 线程的终止时间快，释放的资源相比进程少很多
- 同一个进程内切换线程比进程快，因为线程具有相同的地址空间(虚拟内存共享)，这意味着同一个进程的线程都具有同一个页表，那么在切换的时候不需要切换页表。进程切换时需要切换页表。
- 线程之间数据传递，不需要经过内核，这使得线程之间的数据交互效率更高，因为统一进程的各线程间共享内存和文件资源。

线程的上下文切换
线程是调度的基本单位，进程是资源拥有的基本单位

线程和进程
- 当进程只有一个线程时，可以认为进程就等于线程
- 当进程拥有多个线程时，线程会共享相同的虚拟内存和全局变量等资源，这些资源在上下文切换时不需要修改。
- 不过线程有自己私有的数据，比如寄存器和栈

线程上下文切换时切换什么？
- 当两个线程不是属于同一个进程，则切换的过程就跟进程上下文切换一样
- 当两个线程是属于同一个进程，因为虚拟内存是共享的，所以在切换时，虚拟内存这些资源就保持不变，只需要切换线程的私有数据、寄存器等不共享的数据

### 程序调度








